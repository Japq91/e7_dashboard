<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Flujograma de trabajo — Dashboard de Cambio Climático (offline/online)</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --panel2:#0f1730;
      --text:#e8ecff;
      --muted:#b9c2ffcc;
      --line:#2a3b7a;
      --accent:#7aa2ff;
      --ok:#60d394;
      --warn:#f4d35e;
      --bad:#ee6352;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      background: radial-gradient(1200px 900px at 15% 10%, #1b2b67 0%, var(--bg) 55%, #070a14 100%);
      color: var(--text);
      line-height:1.35;
    }
    header{
      max-width: 1100px;
      margin: 32px auto 0;
      padding: 0 12px;
    }
    h1{
      margin: 0 0 10px;
      font-size: clamp(20px, 2.4vw, 34px);
      letter-spacing: .2px;
    }
    p.lead{
      margin: 0;
      color: var(--muted);
      max-width: 80ch;
    }

    .wrap{
      max-width: 1100px;
      margin: 18px auto 56px;
      padding: 0 18px;
      display: grid;
      gap: 2px;
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(122,162,255,.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .panel .hd{
      display:flex;
      gap:12px;
      align-items:center;
      padding: 14px 16px;
      background: linear-gradient(90deg, rgba(122,162,255,.22), rgba(122,162,255,.06));
      border-bottom: 1px solid rgba(122,162,255,.18);
    }
    .badge{
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 700;
      letter-spacing:.2px;
      font-size: 12px;
      text-transform: uppercase;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      white-space: nowrap;
    }
    .badge.offline{border-color: rgba(96,211,148,.4); background: rgba(96,211,148,.12);}
    .badge.online{border-color: rgba(122,162,255,.45); background: rgba(122,162,255,.14);}
    .badge.io{border-color: rgba(244,211,94,.45); background: rgba(244,211,94,.12);}
    .badge.ref{border-color: rgba(185,194,255,.35); background: rgba(185,194,255,.10);}

    .panel .bd{padding: 14px;}

    .flow{
      display:grid;
      gap: 14px;
    }

    .lane{
      display:grid;
      gap: 12px;
      grid-template-columns: 1.3fr .4fr 1.3fr;
      align-items: stretch;
    }

    @media (max-width: 900px){
      .lane{grid-template-columns: 1fr; }
      .arrow{display:none;}
    }

    .card{
      border-radius: 14px;
      padding: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(122,162,255,.16);
      position: relative;
      min-height: 120px;
    }
    .card h3{margin: 0 0 8px; font-size: 16px;}
    .card ul{margin: 0; padding-left: 18px; color: var(--muted);}
    .card li{margin: 4px 0;}
    .sub{
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px;
    }
    .kpi{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .pill{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      color: var(--text);
      white-space: nowrap;
    }
    .pill.ok{border-color: rgba(96,211,148,.45); background: rgba(96,211,148,.10);}
    .pill.warn{border-color: rgba(244,211,94,.45); background: rgba(244,211,94,.10);}
    .pill.online{border-color: rgba(122,162,255,.5); background: rgba(122,162,255,.12);}

    .arrow{
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 0 4px;
    }

    .arrow svg{width: 110%; max-width: 150px; opacity: .85;}
    .arrow path{stroke: rgba(185,194,255,.75); stroke-width: 2.6; fill: none;}
    .arrow marker path{fill: rgba(185,194,255,.85);}

    .twoCols{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 900px){ .twoCols{grid-template-columns:1fr;} }

    details{
      border: 1px solid rgba(122,162,255,.16);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    summary{
      cursor: pointer;
      padding: 12px 14px;
      list-style: none;
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 700;
      border-bottom: 1px solid rgba(122,162,255,.16);
      background: rgba(122,162,255,.08);
    }
    summary::-webkit-details-marker{display:none;}
    .detailsBody{padding: 12px 14px; color: var(--muted); font-size: 13.5px;}
    code, pre{font-family: var(--mono);}
    pre{
      margin: 10px 0 0;
      padding: 12px;
      border-radius: 12px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
      overflow:auto;
      color: #eaf0ff;
      font-size: 12.5px;
      line-height: 1.35;
    }
    footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12.5px;
      padding: 0 2px 2px;
    }
    .refs{
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 13.5px;
    }
  </style>
</head>
<body>
<header>
  <h1>Flujograma de trabajo — Dashboard de Cambio Climático</h1>
  <p class="lead">
    Se representó el flujo completo del sistema, separando una fase <b>offline</b> (preprocesamiento) y una fase <b>online</b> (dashboard interactivo),
    incluyendo entradas, productos intermedios y rutas de uso.
  </p>
</header>

<main class="wrap">

  <section class="panel" aria-label="Entradas y arquitectura general">
    <div class="hd">
      <span class="badge io">Entradas</span>
      <div style="font-weight:800">Datos de entrada y arquitectura</div>
    </div>
    <div class="bd flow">
      <div class="lane">
        <div class="card">
          <h3>Datos Climáticos (NetCDF)</h3>
          <ul>
            <li>Variables: <b>tasmin</b>, <b>tasmax</b>, <b>pr</b></li>
            <li>Período: <b>1981–2065</b></li>
            <li>Modelos múltiples</li>
            <li>Escenarios: <b>SSP245</b>, <b>SSP585</b></li>
          </ul>
          <div class="kpi">
            <span class="pill warn">CMIP6-like</span>
            <span class="pill warn">Sintético (validación)</span>
          </div>
        </div>

        <div class="arrow" aria-hidden="true">
          <svg viewBox="0 0 120 60" role="img" aria-label="flecha">
            <defs>
              <marker id="a" markerWidth="8" markerHeight="8" refX="6" refY="3.5" orient="auto">
                <path d="M0,0 L7,3.5 L0,7 z"></path>
              </marker>
            </defs>
            <path d="M5 30 C25 10, 45 10, 60 30 S95 50, 115 30" marker-end="url(#a)"></path>
          </svg>
        </div>

        <div class="card">
          <h3>Datos Geoespaciales (GeoJSON)</h3>
          <ul>
            <li><b>peru32.geojson</b></li>
            <li>25 departamentos</li>
            <li>CRS: <b>EPSG:4326</b></li>
          </ul>
          <div class="kpi">
            <span class="pill">Límites administrativos</span>
          </div>
        </div>
      </div>

      <div class="twoCols">
        <div class="card" style="min-height:auto">
          <h3>Principio de diseño</h3>
          <ul>
            <li>Se separó cálculo intensivo (offline) y exploración (online).</li>
            <li>Se evitó recalcular en la interfaz; se cargaron productos ya generados.</li>
          </ul>
          <div class="kpi">
            <span class="pill ok">Respuesta rápida</span>
            <span class="pill ok">Reutilización</span>
            <span class="pill ok">Escalabilidad</span>
          </div>
        </div>
        <div class="card" style="min-height:auto">
          <h3>Comando de ejecución</h3>
          <div class="sub">Se resumió la secuencia típica de uso en consola.</div>
          <pre><code>conda activate e7-cc
python 01_preproc_01_dep.py
python 01_preproc_02_cambio.py
python 01_preproc_03_ens_cdo.py
python 01_preproc_04_toe.py
streamlit run 00_dashboard.py</code></pre>
        </div>
      </div>

      <footer>Contenido sintetizado desde el informe del entregable (Figura 10 y A.3).</footer>
    </div>
  </section>

  <section class="panel" aria-label="Fase offline">
    <div class="hd">
      <span class="badge offline">Fase Offline</span>
      <div style="font-weight:800">Preprocesamiento — módulos y productos</div>
    </div>
    <div class="bd flow">

      <div class="lane">
        <div class="card">
          <h3>1) Series por departamento</h3>
          <ul>
            <li>Conversión grilla → series temporales por departamento</li>
            <li>Salida: <code>data/procesados/*.csv</code></li>
          </ul>
          <div class="kpi">
            <span class="pill ok">Subnacional</span>
            <span class="pill">CSV</span>
          </div>
        </div>

        <div class="arrow" aria-hidden="true">
          <svg viewBox="0 0 120 60">
            <defs>
              <marker id="b" markerWidth="8" markerHeight="8" refX="6" refY="3.5" orient="auto">
                <path d="M0,0 L7,3.5 L0,7 z"></path>
              </marker>
            </defs>
            <path d="M5 30 L115 30" marker-end="url(#b)"></path>
          </svg>
        </div>

        <div class="card">
          <h3>2) Cambios + significancia</h3>
          <ul>
            <li>Anomalías entre períodos</li>
            <li>Test t de Welch, <code>p &lt; 0.05</code></li>
            <li>Salida: <code>data/mod_cambios/*.nc</code> y <code>data/mod_significancia/*.npy</code></li>
          </ul>
          <div class="kpi">
            <span class="pill warn">p-values</span>
            <span class="pill">NetCDF/NPY</span>
          </div>
        </div>
      </div>

      <div class="lane">
        <div class="card">
          <h3>3) Ensamble multimodelo</h3>
          <ul>
            <li>Promedio de modelos con CDO</li>
            <li>Reducción de incertidumbre estructural</li>
            <li>Salida: <code>data/ensamble/datos/*.nc</code> + cambios + significancia</li>
          </ul>
          <div class="kpi">
            <span class="pill ok">ensmean</span>
            <span class="pill">CDO</span>
          </div>
        </div>

        <div class="arrow" aria-hidden="true">
          <svg viewBox="0 0 120 60">
            <defs>
              <marker id="c" markerWidth="8" markerHeight="8" refX="6" refY="3.5" orient="auto">
                <path d="M0,0 L7,3.5 L0,7 z"></path>
              </marker>
            </defs>
            <path d="M5 30 L115 30" marker-end="url(#c)"></path>
          </svg>
        </div>

        <div class="card">
          <h3>4) Time of Emergence (TOE)</h3>
          <ul>
            <li>Señal vs variabilidad natural (SNR)</li>
            <li>Salida: <code>data/ensamble/toe/*.nc</code> (TOE_1, TOE_2)</li>
          </ul>
          <div class="kpi">
            <span class="pill warn">TOE_1 = 1σ</span>
            <span class="pill warn">TOE_2 = 2σ</span>
          </div>
        </div>
      </div>

      <details>
        <summary><span class="badge ref">Detalle</span> Ecuaciones clave (TOE)</summary>
        <div class="detailsBody">
          <div>Se definió la descomposición y la relación señal–ruido:</div>
          <pre><code>X(t) = S(t) + N(t)
SNR(t) = |S(t)| / σ_N
TOE = primer t tal que SNR(t) &gt; τ y SNR(t′) &gt; τ ∀ t′ &gt; t</code></pre>
        </div>
      </details>

      <footer>Etapas y salidas coherentes con el flujograma y el resumen de ejecución.</footer>
    </div>
  </section>

  <section class="panel" aria-label="Fase online">
    <div class="hd">
      <span class="badge online">Fase Online</span>
      <div style="font-weight:800">Dashboard interactivo — uso y vistas</div>
    </div>
    <div class="bd flow">

      <div class="card" style="min-height:auto">
        <h3>Inicio del dashboard (Streamlit)</h3>
        <ul>
          <li>Carga dinámica desde disco</li>
          <li>Visualización sin recálculo de los módulos offline</li>
        </ul>
        <div class="kpi">
          <span class="pill online">streamlit run 00_dashboard.py</span>
          <span class="pill ok">caché</span>
        </div>
      </div>

      <div class="twoCols">
        <div class="card">
          <h3>Vista CAMBIOS</h3>
          <ul>
            <li>Mapas paralelos por modelo</li>
            <li>Opción de superponer significancia (<code>p &lt; 0.05</code>)</li>
          </ul>
          <div class="kpi">
            <span class="pill">Comparación inter-modelo</span>
          </div>
        </div>

        <div class="card">
          <h3>Vista PROMEDIO</h3>
          <ul>
            <li>Consenso multimodelo</li>
            <li>Panel SSP245 + panel SSP585 + panel TOE</li>
          </ul>
          <div class="kpi">
            <span class="pill ok">Consenso</span>
            <span class="pill warn">TOE</span>
          </div>
        </div>

        <div class="card">
          <h3>Vista SERIES</h3>
          <ul>
            <li>Series temporales por departamento</li>
            <li>Trayectorias por modelo + promedio</li>
            <li>Resumen estadístico entre períodos</li>
          </ul>
          <div class="kpi">
            <span class="pill">Diagnóstico temporal</span>
          </div>
        </div>

        <div class="card">
          <h3>Salida para usuario final</h3>
          <ul>
            <li>Mapas de cambio (°C o %)</li>
            <li>Máscara/puntos de significancia</li>
            <li>Mapa TOE (año de emergencia)</li>
            <li>Series y tabla comparativa por departamento</li>
          </ul>
        </div>
      </div>

      <footer>Rutas de interacción y vistas según la descripción de la interfaz.</footer>
    </div>
  </section>

  <section class="panel" aria-label="Referencias">
    <div class="hd">
      <span class="badge ref">Referencias</span>
      <div style="font-weight:800">Bibliografía citada en el informe</div>
    </div>
    <div class="bd">
      <ol class="refs">
        <li>IPCC. (2021). <i>Climate Change 2021: The Physical Science Basis</i>. Cambridge University Press. https://doi.org/10.1017/9781009157896</li>
        <li>Hawkins, E., & Sutton, R. (2012). Time of emergence of climate signals. <i>Geophysical Research Letters, 39</i>(1), L01702. https://doi.org/10.1029/2011GL050087</li>
        <li>Tebaldi, C., & Knutti, R. (2007). The use of the multi-model ensemble in probabilistic climate projections. <i>Philosophical Transactions of the Royal Society A, 365</i>(1857), 2053–2075. https://doi.org/10.1098/rsta.2007.2076</li>
      </ol>
    </div>
  </section>

</main>
</body>
</html>
